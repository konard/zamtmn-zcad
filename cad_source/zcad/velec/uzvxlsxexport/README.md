# Модуль uzvxlsxexport

Генератор XLSX файлов на основе шаблонов для ZCAD.

## Назначение

Модуль предоставляет систему генерации XLSX файлов на основе шаблонов с автоматическим выполнением команд и заполнением данных.

## Основная команда

**UzvXLSXexport** - команда для генерации XLSX файлов на основе шаблона.

### Использование

```
UzvXLSXexport [путь_к_шаблону]
```

- Если путь не указан - открывается диалог выбора файла шаблона
- Если путь указан - выполняется быстрый запуск с указанным шаблоном

## Структура шаблона

Шаблон XLSX должен содержать листы с именами EXPORT1, EXPORT2, EXPORT3 и т.д.

### Команды в листах EXPORT

Команды записываются в ячейках столбца A (A1, A2, A3, A4...).
Параметры команд записываются в столбцах B и C.

#### Поддерживаемые команды:

1. **getaccessfile** - Генерация файла Access БД
   - Вызывает модуль uzvaccess для создания базы данных
   - Не требует параметров

2. **query** - Выполнение запроса к БД
   - Параметр B: имя таблицы
   - Параметр C: текст SQL запроса

## Архитектура модуля

Модуль состоит из следующих компонентов:

### Основные модули:

- **uzvxlsxexport_types.pas** - Определения типов данных
- **uzvxlsxexport_config.pas** - Конфигурация
- **uzvxlsxexport_registry.pas** - Реестр команд
- **uzvxlsxexport_parser.pas** - Парсер инструкций из шаблона
- **uzvxlsxexport_executor.pas** - Исполнитель команд
- **uzvxlsxexport_handlers.pas** - Обработчики команд
- **uzvxlsxexport_command.pas** - Основная команда
- **uzvxlsxexport_cmd_register.pas** - Регистрация в ZCAD
- **uzvxlsxexport_init.pas** - Инициализация модуля

### Архитектурные принципы:

- Трёхуровневая архитектура: Data → Logic → UI
- Модульность: каждый модуль 300-500 строк
- Расширяемость: простое добавление новых команд
- Без использования интерфейсов (по требованию ТЗ)

## Система регистрации команд

Модуль использует гибкую систему регистрации команд:

```pascal
registry.RegisterExportCommand(
  'command_name',
  @HandlerFunction,
  'Description'
);
```

Это позволяет легко добавлять новые типы команд экспорта.

## Пример шаблона

```
Лист EXPORT1:
A1: getaccessfile
A2: query
B2: Devices
C2: SELECT * FROM Devices WHERE Type='Cable'

Лист EXPORT2:
A1: query
B1: Connections
C1: SELECT * FROM Connections
```

## Интеграция

Модуль интегрируется с:
- **uzvaccess** - для генерации Access БД
- **uzvzcadxlsxfps** - для работы с XLSX через fpSpreadsheet

## Стандарты кодирования

Код соответствует стандартам CLAUDE.md:
- Все комментарии на русском языке
- Функции не более 30 строк
- Модули не более 500 строк
- Осмысленные имена переменных
- Логирование через uzclog с уровнем LM_Info

## Автор

Vladimir Bobrov
